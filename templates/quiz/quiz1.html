{% extends "base/navbar.html" %}
{% load static %}
{% block title %}Quiz{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}
    <!-- Navbar Section End -->
    {% block content %}
    <!-- Quiz Main Section Start -->
    <div class="quiz_main_section">

        <!-- step 1 -->
        <div class="quiz_item_section step step-1" id="step1" >
            <h5>Lets Start With Your Name</h5>
            <div class="quiz_input_main_group">
                <div class="quiz_input_group">
                    <label for="email" id="" class="form-label quiz_label">Your Nmae</label>
                    <input type="text" class="form-control quiz_input" id="email" aria-describedby=""
                        placeholder="Enter Your Name" required>
                </div>
                <div class="quiz_next_button">
                    <button type="button" class="next-step"  id="next-step1" onclick="getEmail()"  disabled>Next</button>
                </div>
            </div>
        </div>

        <!-- step 2 -->
        <!-- quiz 2 -->
        <div class="quiz_item_section step step-2" id="step2">
            <h5 id='would_like'> What Would you Like to Learn?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1  m-0" id="box1">
                   A. How to Invest in Property
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box2">
                   B. How to Buy Your Own Home
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box3">
                   C. Where to Start?
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>

            <div class="quiz_next_button">
                <button class="next-step" id="next-step2"   disabled>Next</button>
            </div>
        </div>
        <!-- step 3 -->
        <!-- quiz 3-->
        <div class="quiz_item_section step step-3" id="step3">
            <h5>Are you Aus or NZ Permanent Resident?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1 m-0 " id="box4">
                    A. Yes
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box5">
                    B. No
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>
            <div class="quiz_next_button">
                <button type="button" class="next-step" id="next-step3" disabled>Next</button>
            </div>
        </div>
        <!-- quiz 10-->
        <div class="quiz_item_section step step-4" id="step4">
            <h5>What is your current employment status?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1 m-0 " id="box6">
                    A. Full-Time
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box7">
                    B. Part-Time
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box8">
                    C. Casual
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box9">
                    D. Self-Employed
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box10">
                    E. In between jobs
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>
            <div class="quiz_next_button">
                <button type="button" class="next-step" id="next-step4"  disabled>Next</button>
            </div>
        </div>
        <!-- quiz 11-->
        <div class="quiz_item_section step step-5" id="step5">
            <h5>How much do you have saved up?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1" id="box9">
                    A. $0 - $15,000
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box9">
                    B. $15,000 - $30,000
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box9">
                    C. $30,000 - $45,000
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box8">
                    D. $45,000 - $60,000
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box8">
                    E. $60,000 +
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>
            <div class="quiz_next_button">
                <button type="button" class="next-step" id="next-step5" disabled>Next</button>
            </div>
        </div>
        <div class="quiz_item_section step step-6" id="step6" style="padding-top: 100px;">
            <h5>When you will start full time employment?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1 " id="box10">
                    A. Within 2 months
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box10">
                    B. Within 4 months
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1 " id="box10">
                    C. Within 6 months
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box11">
                    D. within 12 months
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box11">
                    D. Not in the foreseeable future
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>

            <div class="quiz_next_button">
                <button id="next-step8" class="next-step" disabled>Next</button>
            </div>
        </div>

        <div class="quiz_item_section step step-7" id="step7">
            <h5>Will you become and AUS /NZ permanent resident within next 2 years?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1 m-0" id="box10">
                    A. Yes
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box11">
                    B. No
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>

            <div class="quiz_next_button">
                <button id="next-step7" class="next-step" disabled>Next</button>
            </div>
        </div>
        <!-- quiz 7-->
        <div class="quiz_item_section step step-8" id="step8" style="padding-top:10px;">
            <h5>Are you Ready to see you results?</h5>
            <div class="quiz_input_group">
                <label for="email" id="" class="form-label quiz_label">Your Email</label>
                <input type="email" class="form-control quiz_input" id="useremail" aria-describedby=""
                    placeholder=" Your Email" required>
            </div>
            <div class="get_started_button">
                <button type="button" class="get_started_button1" id="next-step111" disabled onclick="sendUserAnswers()">Yes, tell me </button> 
            </div>
        </div>
        <!-- quiz 8 and 17-->
        <div class="quiz_item_section step step-9" id="step9">
            <h5>Would you like to buy property one day in Australia?</h5>
            <div class="quiz_input_main_group">
                <div class="step_2_question_1 m-0" id="box12">
                    A. Yes
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
                <div class="step_2_question_1" id="box13">
                    B. No
                    <span class="plus-icon"><i class='bx bxs-check-circle'></i></span>
                </div>
            </div>

            <div class="quiz_next_button">
                <button id="next-step9" class="next-step" disabled>Next</button>
            </div>
        </div>

        <div class="quiz_item_section step step-20" id="step20" style="padding-top:10px;">
            <h5 id="result_name" > Your results have been emailed to you.</h5>
        </div>
    </div>

    {% endblock %}

    {% block js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
    <!-- jquery cdn -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const steps = document.querySelectorAll('.step');
            const nextButtons = document.querySelectorAll('.next-step');
            let currentStep = 0;

            nextButtons.forEach(button => {
                button.addEventListener('click', function () {
                    steps[currentStep].style.display = 'none';
                    currentStep++;
                    steps[currentStep].style.display = 'block';
                });
            });

            steps[currentStep].style.display = 'block';

            const boxes = document.querySelectorAll('.step_2_question_1');
            const email = document.getElementById('email');
            const nextButton1 = document.getElementById('next-step1');
            const nextButton2 = document.getElementById('next-step2');
            const nextButton3 = document.getElementById('next-step3');
            const nextButton4 = document.getElementById('next-step4');
            const nextButton5 = document.getElementById('next-step5');
            // const nextButton6 = document.getElementById('next-step6');  // You may be Eligible to Invest Now id empty
            const nextButton7 = document.getElementById('next-step7');
            const nextButton8 = document.getElementById('next-step8'); 
            const nextButton9 = document.getElementById('next-step9'); //quiz 14 button

            let selectedBoxId = null;

            boxes.forEach(box => {
                box.addEventListener('click', () => {
                    // Remove 'clicked' class from all boxes
                    boxes.forEach(b => {
                        b.classList.remove('clicked');
                    });
                    box.classList.add('clicked'); // Use 'add' instead of 'toggle'

                    // button enable jquery 
                    let parentget = $(box).parent().parent('.quiz_item_section').children('.quiz_next_button').children('button');
                    parentget.prop('disabled', false);

                    selectedBoxId = box.id;



                    console.log(selectedBoxId, 'box ID')
                });
            });


            // email step jquery 
            $('#email').keyup(function () {
                // const thisVal = $(this).val();
                if (validateEmail()) {
                    $('#next-step1').prop("disabled", false);
                    $('#email').css('border', '1px solid green')
                }
                else {
                    $('#next-step1').prop("disabled", true);
                    $('#email').css('border', '1px solid red')
                }
            });
            function validateEmail() {
                //let reg = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                let reg = /^[a-zA-Z\s]+$/;
                
                let name = $('#email').val();
                if (reg.test(name)) {
                    return true;

                } else {
                    return false;
                }

            }

            // email step jquery 
            $('#useremail').keyup(function () {
                // const thisVal = $(this).val();
                if (validateEmails()) {
                    $('#next-step111').prop("disabled", false);
                    $('#useremail').css('border', '1px solid green')
                }
                else {
                    $('#next-step111').prop("disabled", true);
                    $('#useremail').css('border', '1px solid red')
                }
            });
            function validateEmails() {
                let reg = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                
                let name = $('#useremail').val();
                if (reg.test(name)) {
                    return true;

                } else {
                    return false;
                }

            }
          

            nextButton2.addEventListener('click', () => {
                if (selectedBoxId) {
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box1') {
                        steps[2].style.display = 'block' || selectedBoxId === 'box1'; // Show step 3
                    } else if (selectedBoxId === 'box2') {
                        steps[2].style.display = 'block' || selectedBoxId === 'box2'; // Show step 3
                    } else if (selectedBoxId === 'box3') {
                        //steps[2].style.display = 'none'; // Show step 3
                        steps[2].style.display = 'block' || selectedBoxId === 'box2'; // Show step 3
                    }
                }

            });
            nextButton3.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box4') {
                        steps[3].style.display = 'block'; // Show step 3

                    } if (selectedBoxId === 'box5') {
                        steps[3].style.display = 'none';
                        steps[6].style.display = 'block'; // Show step 4
                    }
                }

            });
            nextButton4.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box6') {
                        steps[4].style.display = 'block';
                        steps[3].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'none';                        

                    } if (selectedBoxId === 'box7') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[5].style.display = 'block';
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'none';
                    }
                    if (selectedBoxId === 'box8') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[5].style.display = 'block'; // Show step 5
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'none';

                    } 
                    if (selectedBoxId === 'box9' ) {
                        steps[4].style.display = 'block';
                        steps[3].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'none';
                    }
                    if (selectedBoxId === 'box10') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[5].style.display = 'block'; 
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'none';
                    }
                }


            });

            nextButton5.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box8') {
                        steps[5].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'block';

                    } if (selectedBoxId === 'box9') {
                        steps[5].style.display = 'block';
                        steps[6].style.display = 'none';
                    }
                }

            });

            nextButton7.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box10') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'block';
                        steps[6].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[8].style.display = 'none';

                    } if (selectedBoxId === 'box11') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[8].style.display = 'block';
                    }
                }

            });
            nextButton8.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box10') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[8].style.display = 'block';
                        //$('#step9').css('display', 'none');

                    } if (selectedBoxId === 'box11') {
                        steps[4].style.display = 'none';
                        steps[3].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[8].style.display = 'block';
                        //$('#step9').css('display', 'none');

                    }
                }

            });


            nextButton9.addEventListener('click', () => {
                if (selectedBoxId) {
                    console.log(`Next button clicked. Selected box ID: ${selectedBoxId}`);
                    // Show the appropriate step based on the selected box
                    if (selectedBoxId === 'box12') {
                        steps[5].style.display = 'none';
                        steps[8].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[4].style.display = 'none';
                        steps[7].style.display = 'block';

                    } if (selectedBoxId === 'box13') {
                        // steps[5].style.display = 'none';
                        steps[8].style.display = 'none';
                        steps[4].style.display = 'none';
                        steps[5].style.display = 'none';
                        steps[6].style.display = 'none';
                        steps[7].style.display = 'block';
                    }
                }

            });

            
        });



    </script>

    
    {% comment %} Take Quiz {% endcomment %}
    <script>

        const userAnswers = {};

        function getEmail(){
            userAnswers['Your name'] = $('#email').val()
            name = $('#email').val()
            $('#would_like').text(name + $('#would_like').text());
            $('#result_name').text('Thanks ' + name + $('#result_name').text());

        }


        function getClickedText(step) {
            const clickedElement = document.querySelector('.step_2_question_1.clicked');
            const h5Text = document.querySelector(`${step} h5`).textContent;            
            if (clickedElement) {
                const clickedText = clickedElement.textContent;
                userAnswers[h5Text]= clickedText
            }
            for (const key in userAnswers) {
                if (userAnswers.hasOwnProperty(key)) {
                    userAnswers[key] = userAnswers[key].trim();
                }
            }
            console.log('userAnswers', userAnswers)

        }

        // Attach a click event listener to your "Next" button
        document.getElementById('next-step2').addEventListener('click', function() {
            getClickedText('.step-2');
        });
        
        document.getElementById('next-step3').addEventListener('click', function() {
            getClickedText('.step-3');
        });
        document.getElementById('next-step4').addEventListener('click', function() {
            getClickedText('.step-4');
        });
        document.getElementById('next-step5').addEventListener('click', function() {
            getClickedText('.step-5');
        });
        document.getElementById('next-step7').addEventListener('click', function() {
            getClickedText('.step-7');
        });
        document.getElementById('next-step9').addEventListener('click', function() {
            getClickedText('.step-9');
        });

        // Function to send the cleaned JSON object via AJAX using jQuery
        function sendUserAnswers() {
            $('.step-20').css('display', 'block');
            $('.step-8').css('display', 'none');
            userAnswers['email'] = $('#useremail').val()

            $.ajax({
                url: '/take_quiz/', 
                type: 'POST',
                data: userAnswers,
                success: function (response) {
                    console.log('Server Response:', response);
                    
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        }

 
    </script>
    {% endblock %}